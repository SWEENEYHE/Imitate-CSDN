<html lang="en" xmlns:th="http://www.thymeleaf.org">
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>修改信息</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<!-- basic styles -->

		<link href="/userinfo/assets/css/bootstrap.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="/userinfo/assets/css/font-awesome.min.css" />

		<!--[if IE 7]>
		  <link rel="stylesheet" href="/userinfo/assets/css/font-awesome-ie7.min.css" />
		<![endif]-->

		<!-- page specific plugin styles -->

		<link rel="stylesheet" href="/userinfo/assets/css/jquery-ui-1.10.3.custom.min.css" />
		<link rel="stylesheet" href="/userinfo/assets/css/jquery.gritter.css" />
		<link rel="stylesheet" href="/userinfo/assets/css/select2.css" />
		<link rel="stylesheet" href="/userinfo/assets/css/bootstrap-editable.css" />

		<!-- fonts -->

		<link rel="stylesheet" href="http://fonts.useso.com/css?family=Open+Sans:400,300" />

		<!-- ace styles -->

		<link rel="stylesheet" href="/userinfo/assets/css/ace.min.css" />
		<link rel="stylesheet" href="/userinfo/assets/css/ace-rtl.min.css" />
		<link rel="stylesheet" href="/userinfo/assets/css/ace-skins.min.css" />

		<!--[if lte IE 8]>
		  <link rel="stylesheet" href="/userinfo/assets/css/ace-ie.min.css" />
		<![endif]-->

		<!-- inline styles related to this page -->

		<!-- ace settings handler -->

		<script src="/userinfo/assets/js/ace-extra.min.js"></script>

		<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->

		<!--[if lt IE 9]>
		<script src="/userinfo/assets/js/html5shiv.js"></script>
		<script src="/userinfo/assets/js/respond.min.js"></script>
		<![endif]-->
	</head>

	<body>
    <!--导航栏-->
    <iframe name="" frameborder="0" scrolling="no" marginwidth="0" marginheight="0"  width="100%" height="38px" src="../html/navigation.html"></iframe>
    <!--导航栏结束-->
		<div class="main-container" id="main-container">
			<script type="text/javascript">
				try{ace.settings.check('main-container' , 'fixed')}catch(e){}
			</script>

			<div class="main-container-inner">
				<div class="main-content">
					<div class="page-content">
						<div class="row">
							<div class="col-xs-12">
								<!-- PAGE CONTENT BEGINS -->
									<div id="user-profile-3" class="user-profile row">
										<div class="col-sm-offset-1 col-sm-10">


											<form id="user-editor-form" class="form-horizontal" action="/updateUser" method="post">
												<div class="tabbable">
													<ul class="nav nav-tabs padding-16">
														<li class="active">
															<a data-toggle="tab" href="#edit-basic">
																<i class="green icon-edit bigger-125"></i>
																修改资料
															</a>
														</li>

														<li>
															<a data-toggle="tab" href="#edit-password">
																<i class="blue icon-key bigger-125"></i>
																修改密码
															</a>
														</li>
													</ul>

													<!--实际内容区-->
													<div class="tab-content profile-edit-tab-content">


														<div id="edit-basic" class="tab-pane in active">
															<h4 class="header blue bolder smaller">基本信息</h4>

															<div class="row">
																<div class="col-xs-12 col-sm-4" id="photo-area">
																	<input type="file" id="img_upload"/>
																	<img th:if="${user.img!=''}" th:src="@{'/img/head_icon/'+${user.img}}" style="width: 150px; height: 112px;">
																</div>

																<div class="vspace-xs"></div>

																<!--第一栏-->
																<div class="col-xs-12 col-sm-8">
																	<div class="space-8"></div>
																	<!--性别-->
																	<div class="form-group">
																		<label class="col-sm-3 control-label no-padding-right">性别</label>

																		<div class="col-sm-9">
																			<label class="inline">
																				<input th:if="${user.ugender==1}" value="1" name="ugender" type="radio" class="ace" checked/>
																				<input th:if="${user.ugender==0}" value="1" name="ugender" type="radio" class="ace" />

																				<span class="lbl"> 男</span>
																			</label>

																			&nbsp; &nbsp; &nbsp;
																			<label class="inline">
																				<input th:if="${user.ugender==0}" name="ugender" value="0" type="radio" class="ace" checked/>
																				<input th:if="${user.ugender==1}" name="ugender" value="0" type="radio" class="ace" />
																				<span class="lbl"> 女</span>
																			</label>
																		</div>
																	</div>
																	<!--电话-->
																	<div class="form-group">
																		<label class="col-sm-3 control-label no-padding-right" for="form-field-phone">联系电话</label>

																		<div class="col-sm-9">
																	<span class="input-icon input-icon-right">
																		<input th:value="${user.utelephone}" name="utelephone" class="input-medium input-mask-phone" type="text" id="form-field-phone" />
																		<i class="icon-phone icon-flip-horizontal"></i>
																	</span>
																		</div>
																	</div>

																</div>
																<!--第一栏end -->
															</div>

															<!--第二栏-->
															<div class="space"></div>
															<h4 class="header blue bolder smaller">个人签名</h4>
															<div class="form-group">
																<label class="col-sm-3 control-label no-padding-right" for="form-field-comment">个人签名</label>
																<!--个性签名-->
																<div class="col-sm-9">
																	<textarea name="ustatement" id="form-field-comment" style="width: 80%;height:150px;">[[${user.ustatement}]]</textarea>
																</div>
																<!--个性签名-->
															</div>
															<!--第二栏end -->
														</div>

														<div id="edit-password" class="tab-pane">
															<div class="space-10"></div>

															<div class="form-group">
																<label class="col-sm-3 control-label no-padding-right" for="form-field-pass1">新密码</label>

																<div class="col-sm-9">
																	<input name="password" type="password" id="form-field-pass1" />
																</div>
															</div>

															<div class="space-4"></div>

															<div class="form-group">
																<label class="col-sm-3 control-label no-padding-right" for="form-field-pass2">确认密码</label>

																<div class="col-sm-9">
																	<input type="password" id="form-field-pass2" />
																</div>
															</div>
														</div>
													</div>
												</div>

												<div class="clearfix form-actions">
													<div class="col-md-offset-3 col-md-9">
														<button id ="submit-form" class="btn btn-info" type="button">
															<i class="icon-ok bigger-110"></i>
															保存
														</button>

														&nbsp; &nbsp;
														<button class="btn" type="reset">
															<i class="icon-undo bigger-110"></i>
															恢复
														</button>
													</div>
												</div>
											</form>
										</div><!-- /span -->
									</div><!-- /user-profile -->

								<!-- PAGE CONTENT ENDS -->
							</div><!-- /.col -->
						</div><!-- /.row -->
					</div><!-- /.page-content -->
				</div><!-- /.main-content -->

			</div><!-- /.main-container-inner -->

			<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
				<i class="icon-double-angle-up icon-only bigger-110"></i>
			</a>
		</div><!-- /.main-container -->

		<!-- basic scripts -->

		<!--[if !IE]> -->

		<script src="http://ajax.useso.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

		<!-- <![endif]-->

		<!--[if IE]>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<![endif]-->

		<!--[if !IE]> -->

		<script type="text/javascript">
			window.jQuery || document.write("<script src='/userinfo/assets/js/jquery-2.0.3.min.js'>"+"<"+"/script>");
		</script>

		<!-- <![endif]-->

		<!--[if IE]>
<script type="text/javascript">
 window.jQuery || document.write("<script src='/userinfo/assets/js/jquery-1.10.2.min.js'>"+"<"+"/script>");
</script>
<![endif]-->

		<script type="text/javascript">
			if("ontouchend" in document) document.write("<script src='/userinfo/assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
		</script>
		<script src="/userinfo/assets/js/bootstrap.min.js"></script>
		<script src="/userinfo/assets/js/typeahead-bs2.min.js"></script>

		<!-- page specific plugin scripts -->

		<!--[if lte IE 8]>
		  <script src="/userinfo/assets/js/excanvas.min.js"></script>
		<![endif]-->

		<script src="/userinfo/assets/js/jquery-ui-1.10.3.custom.min.js"></script>
		<script src="/userinfo/assets/js/jquery.ui.touch-punch.min.js"></script>
		<script src="/userinfo/assets/js/jquery.gritter.min.js"></script>
		<script src="/userinfo/assets/js/bootbox.min.js"></script>
		<script src="/userinfo/assets/js/jquery.slimscroll.min.js"></script>
		<script src="/userinfo/assets/js/jquery.easy-pie-chart.min.js"></script>
		<script src="/userinfo/assets/js/jquery.hotkeys.min.js"></script>
		<script src="/userinfo/assets/js/bootstrap-wysiwyg.min.js"></script>
		<script src="/userinfo/assets/js/select2.min.js"></script>
		<script src="/userinfo/assets/js/date-time/bootstrap-datepicker.min.js"></script>
		<script src="/userinfo/assets/js/fuelux/fuelux.spinner.min.js"></script>
		<script src="/userinfo/assets/js/x-editable/bootstrap-editable.min.js"></script>
		<script src="/userinfo/assets/js/x-editable/ace-editable.min.js"></script>
		<script src="/userinfo/assets/js/jquery.maskedinput.min.js"></script>

		<!-- ace scripts -->

		<script src="/userinfo/assets/js/ace-elements.min.js"></script>
		<script src="/userinfo/assets/js/ace.min.js"></script>

		<!-- inline scripts related to this page -->

	<script type="text/javascript">
        jQuery(function($) {

            //editables on first profile page
            $.fn.editable.defaults.mode = 'inline';
            $.fn.editableform.loading = "<div class='editableform-loading'><i class='light-blue icon-2x icon-spinner icon-spin'></i></div>";
            $.fn.editableform.buttons = '<button type="submit" class="btn btn-info editable-submit"><i class="icon-ok icon-white"></i></button>'+
                '<button type="button" class="btn editable-cancel"><i class="icon-remove"></i></button>';

            //editables
            $('#username').editable({
                type: 'text',
                name: 'username'
            });



            //var $range = document.createElement("INPUT");
            //$range.type = 'range';
            $('#login').editable({
                type: 'slider',//$range.type == 'range' ? 'range' : 'slider',
                name : 'login',
                slider : {
                    min : 1, max:50, width:100
                },
                success: function(response, newValue) {
                    if(parseInt(newValue) == 1)
                        $(this).html(newValue + " hour ago");
                    else $(this).html(newValue + " hours ago");
                }
            });

            $('#about').editable({
                mode: 'inline',
                type: 'wysiwyg',
                name : 'about',
                wysiwyg : {
                    //css : {'max-width':'300px'}
                },
                success: function(response, newValue) {
                }
            });



            // *** editable avatar *** //
            try {//ie8 throws some harmless exception, so let's catch it

                //it seems that editable plugin calls appendChild, and as Image doesn't have it, it causes errors on IE at unpredicted points
                //so let's have a fake appendChild for it!
                if( /msie\s*(8|7|6)/.test(navigator.userAgent.toLowerCase()) ) Image.prototype.appendChild = function(el){}

                var last_gritter
                $('#avatar').editable({
                    type: 'image',
                    name: 'avatar',
                    value: null,
                    image: {
                        //specify ace file input plugin's options here
                        btn_choose: 'Change Avatar',
                        droppable: true,
                        /**
                         //this will override the default before_change that only accepts image files
                         before_change: function(files, dropped) {
								return true;
							},
                         */

                        //and a few extra ones here
                        name: 'avatar',//put the field name here as well, will be used inside the custom plugin
                        max_size: 110000,//~100Kb
                        on_error : function(code) {//on_error function will be called when the selected file has a problem
                            if(last_gritter) $.gritter.remove(last_gritter);
                            if(code == 1) {//file format error
                                last_gritter = $.gritter.add({
                                    title: 'File is not an image!',
                                    text: 'Please choose a jpg|gif|png image!',
                                    class_name: 'gritter-error gritter-center'
                                });
                            } else if(code == 2) {//file size rror
                                last_gritter = $.gritter.add({
                                    title: 'File too big!',
                                    text: 'Image size should not exceed 100Kb!',
                                    class_name: 'gritter-error gritter-center'
                                });
                            }
                            else {//other error
                            }
                        },
                        on_success : function() {
                            $.gritter.removeAll();
                        },

                    },
                    url: function(params) {

                        // ***UPDATE AVATAR HERE*** //
                        //You can replace the contents of this function with examples/profile-avatar-update.js for actual upload


                        var deferred = new $.Deferred

                        //if value is empty, means no valid files were selected
                        //but it may still be submitted by the plugin, because "" (empty string) is different from previous non-empty value whatever it was
                        //so we return just here to prevent problems
                        var value = $('#avatar').next().find('input[type=hidden]:eq(0)').val();
                        if(!value || value.length == 0) {
                            deferred.resolve();
                            return deferred.promise();
                        }

                        return "";
                    },

                    success: function(response, newValue) {
                    }
                })
            }catch(e) {}


            //////////////////图片控制/////////////////////////
            $('#user-profile-3')
                .find('input[type=file]').ace_file_input({
                style:'well',
                btn_choose:'Change avatar',
                btn_change:null,
                no_icon:'icon-picture',
                thumbnail:'large',
                droppable:true,
                before_change: function(files, dropped) {
                    var file = files[0];
                    if(typeof file === "string") {//files is just a file name here (in browsers that don't support FileReader API)
                        if(! (/\.(jpe?g|png|gif)$/i).test(file) ) return false;
                    }
                    else {//file is a File object
                        var type = $.trim(file.type);
                        if( ( type.length > 0 && ! (/^image\/(jpe?g|png|gif)$/i).test(type) )
                            || ( type.length == 0 && ! (/\.(jpe?g|png|gif)$/i).test(file.name) )//for android default browser!
                        ) return false;

                        if( file.size > 11000000 ) {//~100Kb
                            return false;
                        }
                    }

					var formData = new FormData();
                    formData.append("photo",document.getElementById("img_upload").files[0]);

                    $.ajax({
                        type: "post"
                        , url: "/uploadImg"
                        , data: formData
                        , contentType: false
                        , processData: false
                        , success: function (url) {
                            var fileName = url.split('/');
                            if($("#img-input-param").length==0){
                                $("#photo-area").append('<input id="img-input-param" type="hidden" name="img" value="'+fileName[fileName.length-1]+'">');
                            }else{
                                $("#img-input-param").val(fileName[fileName.length-1]);
							}

                            return true;
                        }
                    });
                    return true;
                }
            })
                .end().find('button[type=reset]').on(ace.click_event, function(){
                $('#user-profile-3 input[type=file]').ace_file_input('reset_input');
            })
                .end().find('.date-picker').datepicker().next().on(ace.click_event, function(){
                $(this).prev().focus();
            })
            $('.input-mask-phone').mask('(999) 999-9999');



            $("#submit-form").click(function(){
                if($("#form-field-pass1").val()!=$("#form-field-pass2").val()){
                    alert("两次密码不一致");
                }else{
                    $("#user-editor-form").submit();
				}
			});

        });
	</script>
	<div style="display:none"><script src='http://v7.cnzz.com/stat.php?id=155540&web_id=155540' language='JavaScript' charset='gb2312'></script></div>
</body>

<style>
	.main-container-inner,.page-content {
		background-color: #f5f6f7 !important;
	}
</style>


</html>
